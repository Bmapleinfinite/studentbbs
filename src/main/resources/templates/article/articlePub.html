<!DOCTYPE html>
<html lang="en">
    <head th:replace="header::head-fragment('发布新帖')"></head>
<body>
    <div th:replace="header::header-fragment"></div>
    <div class="layui-container">
        <div class="layui-panel">
            <div class="layui-form-pane" style="margin: 20px;">
                <form class="layui-form" id="articlePubForm" onsubmit="return false" action="##">
                    <div class="layui-form-item">
                        <div class="layui-row layui-col-space15">

                            <div class="layui-col-md6">
                                <label for="title" class="layui-form-label">文章标题</label>
                                <div class="layui-input-block">
                                    <input id="title" name="title" class="layui-input" type="text" required lay-verify="required">
                                </div>
                            </div>

                            <div class="layui-col-md6">
                                <label for="category" class="layui-form-label">所属分类</label>
                                <div class="layui-input-block">
                                    <select name="category" id="category">
                                        <option value=""></option>
                                        <option value="111">提问</option>
                                        <option value="222">分享</option>
                                        <option value="333">搞笑</option>
                                        <option value="444">学习</option>
                                        <option value="555">ヾ(✿ﾟ▽ﾟ)ノ</option>
                                        <option value="666">其他</option>
                                    </select>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="layui-form-item layui-form-text">
                        <div class="layui-input-block">
                            <div id="wangEditor"></div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label for="verifyCode" class="layui-form-label">验证码</label>
                        <div class="layui-input-inline">
                            <input name="verifyCode" id="verifyCode" class="layui-input" type="text">
                        </div>
                        <span><img data-tooltip="看不清楚？换一张" th:src="@{/common/captcha}"
                                onclick="this.src='/common/captcha?d='+new Date()*1" alt="单击图片刷新！"></span>
                    </div>

                    <div class="layui-form-item">
                        <button onclick="articlePub()" class="layui-btn">发布文章</button>
                    </div>
                </form>
            </div>
        </div>
        <input th:value="${session.user.id}" id="userid" name="userid" style="visibility: hidden;" readonly class="layui-input" type="text">
    </div>
    
    <script th:src="@{/layui/layui.js}"></script>
    <script th:src="@{/js/public.js}"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/wangeditor@latest/dist/wangEditor.min.js"></script>
    <script type="text/javascript">
        layui.use(['layer', 'form', 'element', 'jquery'], function () {
            var layer = layui.layer;
            var element = layui.element;
            var $ = layui.$;
            var form = layui.form;

            var E = window.wangEditor
            editor = new E('#wangEditor')
            editor.config.zIndex = 1
            editor.create()

            window.articlePub = function(){
                var userid = $('#userid').val()
                var title = $('#title').val()
                var categoryid = $('#category').val()
                var category = $('#category').find('option:selected').text()
                var content = editor.txt.html()
                console.log(userid)
                console.log(title)
                console.log(categoryid)
                console.log(category)
                console.log(content)
            }
        });
    </script>
</body>
</html>